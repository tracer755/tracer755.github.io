<!DOCTYPE html>
<html lang="en">

<Head>
  <meta name="google-signin-client_id"
    content="529630701561-hk5ka2erbhg4ao9orhlvi1ohrjn0npc3.apps.googleusercontent.com">

  <!--MetaData tags-->
  <title>Troop 456</title>
  <link rel="icon" href="Img/MainLogo.png" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!--End of metadata tags-->

  <!--css file start-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="css/AlertBox.css">
  <link rel="stylesheet" href="css/buttons.css">
  <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
  <!--css file end-->


  <style>
    .alert {
      padding: 20px;
      background-color: #f44336;
      color: white;
      opacity: 1;
      transition: opacity 0.6s;
      margin-bottom: 15px;
    }

    .alert.success {
      background-color: #04AA6D;
    }

    .alert.info {
      background-color: #2196F3;
    }

    .alert.warning {
      background-color: #ff9800;
    }

    .closebtn {
      margin-left: 15px;
      color: white;
      font-weight: bold;
      float: right;
      font-size: 22px;
      line-height: 20px;
      cursor: pointer;
      transition: 0.3s;
    }

    .closebtn:hover {
      color: black;
    }

    .featurebox {
      background-color: black;
      border: 5px solid #AD91FF;
      margin: auto;
      padding: 10px;
      border-radius: 5px;

      width: 400px !important;
      max-height: 7000px !important;
      max-width: 400px !important;
      flex: 1;
      transition: 0.3s;
    }


    hr.year {
      height: 4px;
      border-width: 0;
      color: white;
      background-color: white;
      border: 2px solid white;
      border-radius: 15px;
    }

    .flex-container {
      display: flex;
      flex-direction: column;
      margin: auto;

    }

    @media (min-width: 700px) {
      .flex-container {
        flex-direction: row;
        margin: auto;
      }

      br.mobilehide {
        display: initial;
        margin: auto;
      }

      img.status {
        width: 22%;
      }
    }
  </style>

</head>

<body style="background-color: #1d1e28">
  <!--Page Header start-->
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html"><img class="circle" src="Img/MainLogo.png" alt="TroopLogo" width="75"
          height="75"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <h2 style="font-family: " Lucida Console", "Courier New" , monospace;">Troop 456</h2>
            </a>
          </li>
          <li class="nav-item">
            <h2 class="nav-link" style="font-family: " Lucida Console", "Courier New" , monospace;">-</h2>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <h2 style="font-family: " Lucida Console", "Courier New" , monospace;">Resources</h2>
            </a>
          </li>
          <li class="nav-item">
            <h2 class="nav-link" style="font-family: " Lucida Console", "Courier New" , monospace;">-</h2>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <h2 style="font-family: " Lucida Console", "Courier New" , monospace;">News</h2>
            </a>
          </li>
          <li class="nav-item">
            <h2 class="nav-link" style="font-family: " Lucida Console", "Courier New" , monospace;">-</h2>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="pictures.html">
              <h2 style="font-family: " Lucida Console", "Courier New" , monospace;">Pictures</h2>
            </a>
          </li>
        </ul>
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <div class="g-signin2" data-onsuccess="onSignIn" id="loginButton"></div>

            <h2 id="loginNameText" style="display: none;">N/A</h2>
          </li>
          <li class="nav-item">
            <img src="" alt="User icon" width="50" height="50" style="border-radius: 50%; display: none;"
              id="loginUserIcon">
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!--Page header end-->

  <br><br>
  <!--Login alert-->
  <div class="alert success" id="alertSuccess" style="opacity: 0">
    <span class="closebtn">&times;</span>
    <center><strong>Success!</strong> Login was successful</center>
  </div>


  <div class="alert warning" id="alertFail" style="opacity: 0">
    <span class="closebtn">&times;</span>
    <center><strong>Warning!</strong> Either An error has occoured or you are trying to interact with something you not
      supposed to.</center>
  </div>
  <p></p>

  <br><br>

  <center>
    <h1 id="picturetext" style="color:white; display: none;">Pictures</h1>
    <h1 id="logintext" style="color:white">Please login to edit troop accounts</h1>
  </center>
  <br>
  
  <div class="flex-container" style="background-color: #2b2c3b;">
  <form>
<center>
    <div class="flex-container">
      <form>
        <h5 style="color: white; padding: 7px;">Add user | </h5>
      <h5 style="color: white; padding: 7px;">Email:</h5>
      <input style="padding-right: 15px;" type="text" name="Email" id="EmailInput" size="20">
      <h5 style="color: white; padding: 7px;">Name:</h5>
      <input style="padding-right: 15px;" type="text" name="Name" id="NameInput" size="20">
      <h5 style="color: white; padding: 7px;">Edit:</h5>
      <input type="checkbox" id="edittoggle" name="edittoggle" style="top: 50%;padding: 100px">
      <h5 style="color: white; padding: 7px;">Account:</h5>
      <input type="checkbox" id="accounttoggle" name="accounttoggle" style="top: 50%;padding: 100px">
      <h5 style="color: white; padding: 7px;">Account Type:</h5>
      <select name="accttypeinput" id="accttypeinput">
        <option value="Scout">Scout</option>
        <option value="Adult">Adult</option>
      </select>
    </form>
    </div>
</center>
  </form>
  <button class="button-3" role="button" id="submitbtn">Submit</button>
  </div>

  <div class="flex-container">
    <form>
  <center>
      <div class="flex-container">
        <form>
          <h5 style="color: white; padding: 7px;">Delete user | </h5>
        <h5 style="color: white; padding: 7px;">Email:</h5>
        <input style="padding-right: 15px;" type="text" name="Email" id="EmailInput2" size="20">

      </form>
        
      </div>
      
      
  </center>
    </form>
    <button class="button-3" role="button" id="delbtn">Delete</button>
    </div>

    <center><h3 id="statustext" style="color: white; display: none;">Null</h3></center>



  <br>
  <br>
  <button class="button-3" role="button" id="reloadbtn" style="float: right; margin-right: 40px;">Reload</button>
  <br>



  <center>

    <div id="account header" style="display: none;">
      <h3 style="color: white">User Accounts</h3>
      <hr class="year" width="75%">
    </div>

      <div id="accountlist">
        <div class="flex-container">
          <h3 id="emailtext" style="float: left; color: white; padding-right: 20px; padding-left: 20px;">Email</h3>
          <h3 id="emailtext" style="float: left; color: white; padding-right: 20px; padding-left: 20px;">Name</h3>
          <h3 id="editpermtext" style="float: left; color: white; padding-right: 20px; padding-left: 20px;">Edit Perms</h3>
          <h3 id="accountpermtext" style="float: left; color: white; padding-right: 20px; padding-left: 20px;">Account Perms</h3>
          <h3 id="accounttypetext" style="float: left; color: white; padding-right: 20px; padding-left: 20px;">Account type</h3>
        </div>
        <br>
      </div>

  </center>
<br><br>

  <script>
    var guser = null;
    var useritems = [];

    let btn = document.getElementById("submitbtn");
btn.addEventListener('click', event => {
  adduser();
});

    function adduser(){
      var profile = guser.getBasicProfile();
      axios.get('https://troop456loginapinodejs.herokuapp.com/adduser:' + profile.getEmail() + "::" + document.getElementById("EmailInput").value + "::" + document.getElementById("edittoggle").checked + "::" + document.getElementById("accounttoggle").checked + "::" + document.getElementById("accttypeinput").value + "::" + document.getElementById("NameInput").value)
        .then(response => {
          if(response.data == "error"){
            document.getElementById("statustext").innerHTML = "error";
            document.getElementById("statustext").style.display = "block";
            return;
          }
          if(response.data == "edit success"){
            document.getElementById("statustext").innerHTML = "Account successfuly edited";
            document.getElementById("statustext").style.display = "block";
            console.log(response.data);
            return;
          }
          document.getElementById("statustext").innerHTML = "Account creation success";
          document.getElementById("statustext").style.display = "block";
          console.log(response.data);
        })
        setTimeout(() => {reloadUserList();}, 500);
    }

    let btn2 = document.getElementById("delbtn");
btn2.addEventListener('click', event => {

  deleteuser();
});

    function deleteuser(){
      var profile = guser.getBasicProfile();
      axios.get('https://troop456loginapinodejs.herokuapp.com/deluser:' + profile.getEmail() + "::" + document.getElementById("EmailInput2").value)
        .then(response => {
          if(response.data == "error"){
            document.getElementById("statustext").innerHTML = "error";
            document.getElementById("statustext").style.display = "block";
            return;
          }
          document.getElementById("statustext").innerHTML = "Account deletion success";
          document.getElementById("statustext").style.display = "block";
          console.log(response.data);
        })
        setTimeout(() => {reloadUserList();}, 500);
    }
    let btn3 = document.getElementById("reloadbtn");
btn3.addEventListener('click', event => {

  reloadUserList();
});

    function reloadUserList(){
      var profile = guser.getBasicProfile();
      if(useritems.length > 0){
        for (var i = 0; i < useritems.length; i++) {
          useritems[i].remove();
        }
      }
      axios.get('https://troop456loginapinodejs.herokuapp.com/userlist:' + profile.getEmail())
      .then(response => {
        if(response.data == "error"){
          return;
        }
        console.log(response.data);


        for (var i = 0; i < response.data.length; i++) {


          var usercontainer = document.getElementById("accountlist");


          let div = document.createElement('div');

          div.classList.add('flex-container');

          div.innerHTML = `
            <h5 id="emailtext" style="float: left; color: white; padding-right: 20px; padding-left: 16px;">Email</h5>
            <h5 id="username" style="float: left; color: white; padding-right: 20px; padding-left: 16px;">Name</h5>
            <h5 id="editpermtext" style="float: left; color: white; padding-right: 20px; padding-left: 16px;">Edit Perms</h5>
            <h5 id="accountpermtext" style="float: left; color: white; padding-right: 20px; padding-left: 16px;">Account Prems</h5>
            <h5 id="accounttypetext" style="float: left; color: white; padding-right: 20px; padding-left: 16px;">Account type</h5>`;


          document.getElementById("accountlist").appendChild(div);

          div.querySelector("#emailtext").innerHTML = response.data[i].Email;
          div.querySelector("#username").innerHTML = response.data[i].Name;
          div.querySelector("#editpermtext").innerHTML = response.data[i].Edit;
          div.querySelector("#accountpermtext").innerHTML = response.data[i].AccountControl;
          div.querySelector("#accounttypetext").innerHTML = response.data[i].Type;

          div.style["padding-bottom"] = "10px";

          useritems.push(div);
        }



      })





    }

    window.onload = function () {

      document.getElementById("loginNameText").style.display = "none";
      document.getElementById("loginUserIcon").style.display = "none";
      document.getElementById("alertFail").style.display = "none";
      document.getElementById("alertSuccess").style.display = "none";

      return;

    }

    function onSignIn(googleUser) {
      var profile = googleUser.getBasicProfile();

      guser = googleUser;

      let latch = true;

      axios.get('https://troop456loginapinodejs.herokuapp.com/email:' + profile.getEmail())
        .then(response => {
          console.log(response.data);
          if (response.data == "error") {
            console.log("Error / 404");
            document.getElementById("alertFail").style.opacity = "1";
            document.getElementById("alertFail").style.display = "block";
            signOut();
            latch = false;
            return;
          }
          if (response.data != "error") {
            console.log("loginSuccess");
            SetProfileData(googleUser);
          }
        })
    }

    function SetProfileData(googleUser) {
      var profile = googleUser.getBasicProfile();

      console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
      console.log('Name: ' + profile.getName());
      console.log('Image URL: ' + profile.getImageUrl());
      console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
      document.getElementById("loginButton").style.display = "none";
      document.getElementById("loginNameText").style.display = "block";
      document.getElementById("loginUserIcon").style.display = "block";
      document.getElementById("alertSuccess").style.opacity = "1";
      document.getElementById("alertSuccess").style.display = "block";
      document.getElementById("logintext").style.display = "none";
      document.getElementById("account header").style.display = "block";

      document.getElementById("loginNameText").innerHTML = profile.getName() + "";
      document.getElementById("loginUserIcon").src = profile.getImageUrl();

      reloadUserList();
    }

    function signOut() {
      var auth2 = gapi.auth2.getAuthInstance();
      auth2.signOut().then(function () {
        console.log('User signed out.');
        document.getElementById("loginButton").style.display = "block";
        document.getElementById("loginNameText").style.display = "none";
        document.getElementById("loginUserIcon").style.display = "none";
        document.getElementById("loginNameText").innerHTML = "N/A";
        document.getElementById("loginUserIcon").src = "";
        document.getElementById("logintext").style.display = "block";
        document.getElementById("picturetext").style.display = "none";
      });
    }
  </script>
  <script>
    var close = document.getElementsByClassName("closebtn");
    var i;

    for (i = 0; i < close.length; i++) {
      close[i].onclick = function () {
        var div = this.parentElement;
        div.style.opacity = "0";
        setTimeout(function () { div.style.display = "none"; }, 600);
      }
    }
  </script>

  <!--BootStrap Code Do not Edit-->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  <!--End Of bootstrap code-->
  <!--Misc Script Start-->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <!--Misc Script End-->
</body>

</html>